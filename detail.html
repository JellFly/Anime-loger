<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Tracker - D√©tails</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .detail-header {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .detail-poster {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .detail-poster img {
            width: 100%;
            height: auto;
            display: block;
        }

        .detail-info h1 {
            font-size: 36px;
            margin: 0 0 8px 0;
            color: var(--text);
        }

        .detail-year {
            color: var(--text-muted);
            font-size: 16px;
            margin-bottom: 24px;
        }

        .detail-rating {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-rating-stars {
            font-size: 32px;
        }

        .detail-rating-score {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .detail-rating-text {
            color: var(--text-muted);
            font-size: 14px;
        }

        .detail-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .detail-meta-item h3 {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .detail-meta-item p {
            margin: 0;
            font-size: 14px;
            color: var(--text);
        }

        .detail-genres {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .genre-badge {
            display: inline-block;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .detail-actions {
            display: flex;
            gap: 12px;
        }

        .detail-actions button {
            flex: 1;
            padding: 12px 24px;
        }

        .detail-tabs {
            display: flex;
            gap: 32px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .detail-tabs button {
            padding: 16px 0;
            border: none;
            background: none;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .detail-tabs button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .detail-tabs button:hover {
            color: var(--text);
        }

        .detail-tab-content {
            display: none;
        }

        .detail-tab-content.active {
            display: block;
        }

        .detail-synopsis {
            line-height: 1.8;
            font-size: 15px;
            color: var(--text-muted);
        }

        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .cast-item {
            text-align: center;
        }

        .cast-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .cast-item .cast-name {
            font-weight: 600;
            color: var(--text);
        }

        .cast-item .cast-role {
            font-size: 12px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .detail-header {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .detail-info h1 {
                font-size: 24px;
            }

            .detail-meta {
                grid-template-columns: 1fr;
            }

            .detail-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>üé¨ Anime Tracker</h1>
    </div>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="add.html">Ajouter</a>
        <a href="search.html">üîç Recherche</a>
        <a href="list.html">Ma Biblioth√®que</a>
        <a href="watchlist.html">‚è≥ Watchlist</a>
        <a href="about.html">√Ä propos</a>
    </nav>
    <div class="header-right">
        <div class="auth-icon" onclick="window.toggleAuthOrProfile()" id="authIcon">üë§</div>
    </div>
</header>

<main>
<section>
    <button class="btn-secondary" onclick="window.history.back()" style="margin-bottom: 24px; width: auto;">‚Üê Retour</button>
    
    <div class="detail-header">
        <div class="detail-poster">
            <img id="detailPoster" src="https://via.placeholder.com/400x600" alt="Poster">
        </div>
        <div class="detail-info">
            <h1 id="detailTitle">Titre</h1>
            <div class="detail-year" id="detailYear">2024</div>
            
            <div class="detail-rating">
                <div class="detail-rating-stars" id="detailStars">‚≠ê‚≠ê‚≠ê</div>
                <div>
                    <div class="detail-rating-score" id="detailScore">7.5/10</div>
                    <div class="detail-rating-text">Note TMDB</div>
                </div>
            </div>

            <div class="detail-meta">
                <div class="detail-meta-item">
                    <h3>Type</h3>
                    <p id="detailType">Film</p>
                </div>
                <div class="detail-meta-item">
                    <h3>Classification</h3>
                    <p id="detailClassification">-</p>
                </div>
                <div class="detail-meta-item">
                    <h3>Dur√©e</h3>
                    <p id="detailDuration">-</p>
                </div>
                <div class="detail-meta-item">
                    <h3>R√©alisateur</h3>
                    <p id="detailDirector">-</p>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <h3 style="margin: 0 0 12px 0;">Genres</h3>
                <div class="detail-genres" id="detailGenres"></div>
            </div>

            <div class="detail-actions">
                <button class="btn-primary" onclick="window.addToLibraryFromDetail()">‚ûï Ajouter √† ma biblioth√®que</button>
                <button class="btn-secondary" onclick="window.addToWatchlist()">‚è≥ Ajouter √† la watchlist</button>
            </div>
        </div>
    </div>

    <div class="detail-tabs">
        <button class="detail-tab-btn active" onclick="window.switchDetailTab('synopsis')">Aper√ßu</button>
        <button class="detail-tab-btn" onclick="window.switchDetailTab('cast')">Distribution et √©quipe</button>
    </div>

    <div id="synopsis" class="detail-tab-content active">
        <h3>Synopsis</h3>
        <div class="detail-synopsis" id="detailSynopsis">Pas de description disponible</div>
    </div>

    <div id="cast" class="detail-tab-content">
        <h3>Distribution et √©quipe</h3>
        <div class="cast-grid" id="detailCast"></div>
    </div>
</section>
</main>

<script src="site.js"></script>
<script>
    window.switchDetailTab = function(tab) {
        // Masquer tous les onglets
        document.querySelectorAll('.detail-tab-content').forEach(el => {
            el.classList.remove('active');
        });
        document.querySelectorAll('.detail-tab-btn').forEach(el => {
            el.classList.remove('active');
        });

        // Afficher l'onglet s√©lectionn√©
        document.getElementById(tab).classList.add('active');
        event.target.classList.add('active');
    };

    window.loadDetailPage = async function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        
        if(!detail) {
            document.querySelector('main').innerHTML = '<section><p style="color: red;">Erreur: Aucune donn√©e √† afficher</p></section>';
            return;
        }

        // Remplir les informations
        document.getElementById('detailTitle').textContent = detail.title || detail.name || 'Sans titre';
        document.getElementById('detailYear').textContent = detail.year || '?';
        document.getElementById('detailPoster').src = detail.poster || 'https://via.placeholder.com/400x600';
        document.getElementById('detailType').textContent = detail.type === 'movie' ? 'üé¨ Film' : detail.type === 'anime' ? 'üéå Anim√©' : 'üì∫ S√©rie';
        
        const rating = detail.vote_average || 0;
        const stars = Math.round(rating / 2);
        document.getElementById('detailStars').textContent = '‚≠ê'.repeat(Math.max(0, Math.min(5, stars)));
        document.getElementById('detailScore').textContent = (rating).toFixed(1) + '/10';
        
        document.getElementById('detailSynopsis').textContent = detail.overview || 'Pas de description disponible';
        
        // Genres
        if(detail.genres && detail.genres.length > 0) {
            document.getElementById('detailGenres').innerHTML = detail.genres
                .map(g => `<span class="genre-badge">${g}</span>`)
                .join('');
        }

        // Cast
        if(detail.cast && detail.cast.length > 0) {
            document.getElementById('detailCast').innerHTML = detail.cast
                .slice(0, 6)
                .map(actor => `
                    <div class="cast-item">
                        <img src="${actor.image || 'https://via.placeholder.com/150x225'}" alt="${actor.name}" onerror="this.src='https://via.placeholder.com/150x225'">
                        <div class="cast-name">${actor.name}</div>
                        <div class="cast-role">${actor.role || ''}</div>
                    </div>
                `)
                .join('');
        }

        // Informations suppl√©mentaires
        if(detail.director) {
            document.getElementById('detailDirector').textContent = detail.director;
        }
        if(detail.duration) {
            document.getElementById('detailDuration').textContent = detail.duration + ' minutes';
        }
    };

    window.addToLibraryFromDetail = function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const item = {
            title: detail.title || detail.name,
            image: detail.poster || 'https://via.placeholder.com/400x600',
            rating: 3,
            date: new Date().toISOString().split("T")[0],
            comment: ""
        };

        localStorage.setItem("editingItem", JSON.stringify(item));
        localStorage.setItem("editingType", detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series');
        localStorage.setItem("editingIndex", "");

        window.location.href = "add.html";
    };

    window.addToWatchlist = function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const title = detail.title || detail.name;
        alert(`"${title}" a √©t√© ajout√© √† votre watchlist !`);
        
        // Charger les profils et ajouter √† la watchlist
        if(window.profiles && window.profiles.length > 0) {
            const profile = window.profiles[window.currentProfileIndex || 0];
            if(profile) {
                profile.watch = profile.watch || [];
                profile.watch.push(title);
                window.saveProfiles();
            }
        }
    };

    // Charger la page au chargement
    setTimeout(() => {
        window.loadDetailPage();
    }, 300);
</script>

</body>
</html>
