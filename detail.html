<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineNote - D√©tails</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .detail-header {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .detail-poster {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .detail-poster img {
            width: 100%;
            height: auto;
            display: block;
        }

        .detail-info h1 {
            font-size: 36px;
            margin: 0 0 8px 0;
            color: var(--text);
        }

        .detail-year {
            color: var(--text-muted);
            font-size: 16px;
            margin-bottom: 24px;
        }

        .detail-rating {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-rating-stars {
            font-size: 32px;
        }

        .detail-rating-score {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .detail-rating-text {
            color: var(--text-muted);
            font-size: 14px;
        }

        .detail-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .detail-meta-item h3 {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .detail-meta-item p {
            margin: 0;
            font-size: 14px;
            color: var(--text);
        }

        .detail-genres {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .genre-badge {
            display: inline-block;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .detail-actions {
            display: flex;
            gap: 12px;
        }

        .detail-actions button {
            flex: 1;
            padding: 12px 24px;
        }

        .detail-tabs {
            display: flex;
            gap: 32px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .detail-tabs button {
            padding: 16px 0;
            border: none;
            background: none;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .detail-tabs button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .detail-tabs button:hover {
            color: var(--text);
        }

        .detail-tab-content {
            display: none;
        }

        .detail-tab-content.active {
            display: block;
        }

        .detail-synopsis {
            line-height: 1.8;
            font-size: 15px;
            color: var(--text-muted);
        }

        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .cast-item {
            text-align: center;
        }

        .cast-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .cast-item .cast-name {
            font-weight: 600;
            color: var(--text);
        }

        .cast-item .cast-role {
            font-size: 12px;
            color: var(--text-muted);
        }

        .action-box {
            background: linear-gradient(135deg, #3d4f5f 0%, #2d3e4e 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            text-align: center;
        }

        .action-box-top {
            display: flex;
            justify-content: space-around;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-icon-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s;
            color: var(--text-muted);
            font-weight: 500;
            font-size: 13px;
        }

        .action-icon-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        .action-icon-btn .icon {
            font-size: 24px;
        }

        .action-box-rating {
            margin-bottom: 20px;
        }

        .action-box-rating h4 {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .rating-stars-interactive {
            font-size: 24px;
            letter-spacing: 4px;
            cursor: pointer;
        }

        .rating-stars-interactive span {
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-stars-interactive span:hover {
            transform: scale(1.2);
        }

        .action-box-btn {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .action-box-btn button {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: var(--text-muted);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .action-box-btn button:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .detail-header {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .detail-info h1 {
                font-size: 24px;
            }

            .detail-meta {
                grid-template-columns: 1fr;
            }

            .detail-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>üé¨ CineNote</h1>
    </div>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="search.html">üîç Recherche</a>
        <a href="list.html">Ma Biblioth√®que</a>
        <a href="watchlist.html">‚è≥ Watchlist</a>
        <a href="about.html">√Ä propos</a>
    </nav>
    <div class="header-right">
        <div class="auth-icon" onclick="window.toggleAuthOrProfile()" id="authIcon">üë§</div>
    </div>
</header>

<!-- Review Modal -->
<div class="modal" id="reviewModal">
    <div class="modal-content" style="max-width: 600px;">
        <button class="modal-close" onclick="window.closeReviewModal()">&times;</button>
        <h2>üìù Ajouter un avis</h2>
        
        <div class="form-group">
            <label for="reviewText">Votre avis</label>
            <textarea id="reviewText" placeholder="Partage ton avis sur ce film..." style="min-height: 120px;"></textarea>
        </div>

        <div style="display: flex; gap: 12px;">
            <button class="btn-primary" onclick="window.saveReview()" style="flex: 1;">üíæ Sauvegarder</button>
            <button class="btn-secondary" onclick="window.closeReviewModal()" style="flex: 1;">Annuler</button>
        </div>
    </div>
</div>

<main>
<section>
    <button class="btn-secondary" onclick="window.history.back()" style="margin-bottom: 24px; width: auto;">‚Üê Retour</button>
    
    <div class="detail-header">
        <div class="detail-poster">
            <img id="detailPoster" src="https://via.placeholder.com/400x600" alt="Poster">
        </div>
        <div class="detail-info">
            <h1 id="detailTitle">Titre</h1>
            <div class="detail-year" id="detailYear">2024</div>
            
            <div class="detail-rating">
                <div class="detail-rating-stars" id="detailStars">‚≠ê‚≠ê‚≠ê</div>
                <div>
                    <div class="detail-rating-score" id="detailScore">7.5/10</div>
                    <div class="detail-rating-text">Note TMDB</div>
                </div>
            </div>

            <div class="detail-meta">
                <div class="detail-meta-item">
                    <h3>Type</h3>
                    <p id="detailType">Film</p>
                </div>
                <div class="detail-meta-item">
                    <h3>Classification</h3>
                    <p id="detailClassification">-</p>
                </div>
                <div class="detail-meta-item">
                    <h3>Dur√©e</h3>
                    <p id="detailDuration">-</p>
                </div>
                <div class="detail-meta-item">
                    <h3>R√©alisateur</h3>
                    <p id="detailDirector">-</p>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <h3 style="margin: 0 0 12px 0;">Genres</h3>
                <div class="detail-genres" id="detailGenres"></div>
            </div>

            <div class="action-box">
                <div class="action-box-top">
                    <div class="action-icon-btn" onclick="window.toggleWatched()">
                        <div class="icon">üëÅÔ∏è</div>
                        <span id="watchedText">Regard√©</span>
                    </div>
                    <div class="action-icon-btn" onclick="window.toggleLike()">
                        <div class="icon">‚ù§Ô∏è</div>
                        <span id="likeText">J'aime</span>
                    </div>
                    <div class="action-icon-btn" onclick="window.addToWatchlist()">
                        <div class="icon">‚è±Ô∏è‚ûï</div>
                        <span>Watchlist</span>
                    </div>
                </div>

                <div class="action-box-rating">
                    <h4>Note personnelle</h4>
                    <div class="rating-stars-interactive" id="userRating">
                        <span onclick="window.setUserRating(0.5)">‚≠ê</span>
                        <span onclick="window.setUserRating(1)">‚≠ê</span>
                        <span onclick="window.setUserRating(1.5)">‚≠ê</span>
                        <span onclick="window.setUserRating(2)">‚≠ê</span>
                        <span onclick="window.setUserRating(2.5)">‚≠ê</span>
                        <span onclick="window.setUserRating(3)">‚≠ê</span>
                        <span onclick="window.setUserRating(3.5)">‚≠ê</span>
                        <span onclick="window.setUserRating(4)">‚≠ê</span>
                        <span onclick="window.setUserRating(4.5)">‚≠ê</span>
                        <span onclick="window.setUserRating(5)">‚≠ê</span>
                    </div>
                </div>

                <div class="action-box-btn">
                    <button onclick="window.addToLibraryFromDetail()" style="background: rgba(99, 102, 241, 0.3); border-color: var(--primary); color: var(--primary); font-weight: 600;">‚ûï Ajouter √† ma biblioth√®que</button>
                    <button onclick="window.openReview()">üìù Ajouter un avis</button>
                </div>
            </div>


        </div>
    </div>

    <div class="detail-tabs">
        <button class="detail-tab-btn active" onclick="window.switchDetailTab('synopsis')">Aper√ßu</button>
        <button class="detail-tab-btn" onclick="window.switchDetailTab('cast')">Distribution et √©quipe</button>
    </div>

    <div id="synopsis" class="detail-tab-content active">
        <h3>Synopsis</h3>
        <div class="detail-synopsis" id="detailSynopsis">Pas de description disponible</div>
    </div>

    <div id="cast" class="detail-tab-content">
        <h3>Distribution et √©quipe</h3>
        <div class="cast-grid" id="detailCast"></div>
    </div>
</section>
</main>

<script src="site.js"></script>
<script>
    window.switchDetailTab = function(tab) {
        // Masquer tous les onglets
        document.querySelectorAll('.detail-tab-content').forEach(el => {
            el.classList.remove('active');
        });
        document.querySelectorAll('.detail-tab-btn').forEach(el => {
            el.classList.remove('active');
        });

        // Afficher l'onglet s√©lectionn√©
        document.getElementById(tab).classList.add('active');
        event.target.classList.add('active');
    };

    window.loadDetailPage = async function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        
        if(!detail) {
            document.querySelector('main').innerHTML = '<section><p style="color: red;">Erreur: Aucune donn√©e √† afficher</p></section>';
            return;
        }

        const currentDetail = detail.title || detail.name;
        
        // Charger l'√©tat sauvegard√© depuis Firebase/localStorage
        const state = window.getDetailStateFromFirebase(currentDetail);

        // Remplir les informations
        document.getElementById('detailTitle').textContent = detail.title || detail.name || 'Sans titre';
        document.getElementById('detailYear').textContent = detail.year || '?';
        document.getElementById('detailPoster').src = detail.poster || 'https://via.placeholder.com/400x600';
        document.getElementById('detailType').textContent = detail.type === 'movie' ? 'üé¨ Film' : detail.type === 'anime' ? 'üéå Anim√©' : 'üì∫ S√©rie';
        
        const rating = detail.vote_average || 0;
        const stars = Math.round(rating / 2);
        document.getElementById('detailStars').textContent = '‚≠ê'.repeat(Math.max(0, Math.min(5, stars)));
        document.getElementById('detailScore').textContent = (rating).toFixed(1) + '/10';
        
        document.getElementById('detailSynopsis').textContent = detail.overview || 'Pas de description disponible';
        
        // Genres
        if(detail.genres && detail.genres.length > 0) {
            document.getElementById('detailGenres').innerHTML = detail.genres
                .map(g => `<span class="genre-badge">${g}</span>`)
                .join('');
        }

        // Cast
        if(detail.cast && detail.cast.length > 0) {
            document.getElementById('detailCast').innerHTML = detail.cast
                .slice(0, 6)
                .map(actor => `
                    <div class="cast-item">
                        <img src="${actor.image || 'https://via.placeholder.com/150x225'}" alt="${actor.name}" onerror="this.src='https://via.placeholder.com/150x225'">
                        <div class="cast-name">${actor.name}</div>
                        <div class="cast-role">${actor.role || ''}</div>
                    </div>
                `)
                .join('');
        }

        // Informations suppl√©mentaires
        if(detail.director) {
            document.getElementById('detailDirector').textContent = detail.director;
        }
        if(detail.duration) {
            document.getElementById('detailDuration').textContent = detail.duration + ' minutes';
        }

        // Charger les √©tats sauvegard√©s
        if(state.watched) {
            document.getElementById('watchedText').textContent = '‚úì Regard√©';
            document.querySelector('[onclick="window.toggleWatched()"]').style.color = 'var(--primary)';
        }
        if(state.liked) {
            const likeBtn = document.querySelector('[onclick="window.toggleLike()"]');
            likeBtn.innerHTML = '‚ù§Ô∏è<span id="likeText">J\'aime</span>';
            likeBtn.style.color = 'var(--primary)';
        }
        if(state.rating > 0) {
            window.displayRating(state.rating);
        }
    };

    window.displayRating = function(rating) {
        const ratingEl = document.getElementById('userRating');
        ratingEl.innerHTML = '';
        const steps = [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];
        steps.forEach((star, i) => {
            const span = document.createElement('span');
            span.textContent = '‚≠ê';
            span.style.opacity = i < rating * 2 ? '1' : '0.3';
            span.onclick = () => window.setUserRating(star);
            ratingEl.appendChild(span);
        });
    };

    window.addToLibraryFromDetail = function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const type = detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series';
        const item = {
            tmdbId: detail.tmdbId,
            tmdbType: detail.type,
            title: detail.title || detail.name,
            image: detail.poster || 'https://via.placeholder.com/400x600',
            rating: 3,
            date: new Date().toISOString().split("T")[0],
            comment: "",
            liked: false,
            watched: false
        };

        // Ajouter directement √† la biblioth√®que
        if(!window.profiles) {
            window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
            window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
        }
        
        if(window.profiles && window.profiles.length > 0) {
            const profile = window.profiles[window.currentProfileIndex || 0];
            if(profile) {
                const targetList = type === 'animes' ? profile.animes : type === 'films' ? profile.films : profile.series;
                
                // V√©rifier que le film n'existe pas d√©j√†
                const exists = targetList.find(a => a.title === item.title);
                if(!exists) {
                    targetList.push(item);
                    if(window.saveProfiles) {
                        window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                    alert(`"${item.title}" ajout√© √† votre biblioth√®que !`);
                } else {
                    alert(`"${item.title}" est d√©j√† dans votre biblioth√®que !`);
                }
            }
        }
    };

    window.addToWatchlist = function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const title = detail.title || detail.name;
        
        // Charger les profils si n√©cessaire
        if(!window.profiles) {
            window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
            window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
        }
        
        // Charger les profils et ajouter √† la watchlist
        if(window.profiles && window.profiles.length > 0) {
            const profile = window.profiles[window.currentProfileIndex || 0];
            if(profile) {
                profile.watch = profile.watch || [];
                if(!profile.watch.includes(title)) {
                    profile.watch.push(title);
                    if(window.saveProfiles) {
                        window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                    alert(`"${title}" a √©t√© ajout√© √† votre watchlist !`);
                } else {
                    alert(`"${title}" est d√©j√† dans votre watchlist`);
                }
            }
        }
    };

    window.toggleWatched = async function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const currentDetail = detail.title || detail.name;
        const state = window.getDetailStateFromFirebase(currentDetail);
        state.watched = !state.watched;

        // Sauvegarder sur Firebase
        await window.saveDetailStateToFirebase(currentDetail, state);

        // Si watched, ajouter √† la biblioth√®que
        if(state.watched) {
            const type = detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series';
            const item = {
                tmdbId: detail.tmdbId,
                tmdbType: detail.type,
                title: currentDetail,
                image: detail.poster || 'https://via.placeholder.com/400x600',
                rating: state.rating || 0,
                date: new Date().toISOString().split("T")[0],
                comment: state.review || "",
                liked: state.liked || false,
                watched: true
            };
            
            // Charger les profils et ajouter
            if(!window.profiles) {
                window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
                window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
            }
            
            if(window.profiles && window.profiles.length > 0) {
                const profile = window.profiles[window.currentProfileIndex || 0];
                if(profile) {
                    const arr = type === 'animes' ? profile.animes : type === 'films' ? profile.films : profile.series;
                    // V√©rifier que le film n'existe pas d√©j√†
                    const exists = arr.find(a => a.title === currentDetail);
                    if(!exists) {
                        arr.push(item);
                        if(window.saveProfiles) {
                            await window.saveProfiles();
                        } else {
                            localStorage.setItem("profiles", JSON.stringify(window.profiles));
                        }
                    }
                    alert(`"${currentDetail}" ajout√© √† votre biblioth√®que !`);
                }
            }
        } else {
            const btn = document.querySelector('[onclick="window.toggleWatched()"]');
            if(btn) {
                btn.style.color = 'var(--text-muted)';
                document.getElementById('watchedText').textContent = 'Regard√©';
            }
        }
    };

    window.toggleLike = async function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const currentDetail = detail.title || detail.name;
        const state = window.getDetailStateFromFirebase(currentDetail);
        state.liked = !state.liked;

        // Sauvegarder sur Firebase
        await window.saveDetailStateToFirebase(currentDetail, state);

        // Si liked, ajouter √† la biblioth√®que avec tag "liked"
        if(state.liked) {
            const type = detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series';
            const item = {
                title: currentDetail,
                image: detail.poster || 'https://via.placeholder.com/400x600',
                rating: state.rating || 0,
                date: new Date().toISOString().split("T")[0],
                comment: state.review || "",
                liked: true
            };
            
            // Charger les profils et ajouter
            if(!window.profiles) {
                window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
                window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
            }
            
            if(window.profiles && window.profiles.length > 0) {
                const profile = window.profiles[window.currentProfileIndex || 0];
                if(profile) {
                    const arr = type === 'animes' ? profile.animes : type === 'films' ? profile.films : profile.series;
                    const exists = arr.find(a => a.title === currentDetail);
                    if(exists) {
                        exists.liked = true;
                    } else {
                        arr.push(item);
                    }
                    if(window.saveProfiles) {
                        await window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                    alert(`"${currentDetail}" ajout√© √† vos favoris !`);
                }
            }
        } else {
            const btn = document.querySelector('[onclick="window.toggleLike()"]');
            if(btn) {
                btn.style.color = 'var(--text-muted)';
                btn.innerHTML = 'ü§ç<span id="likeText">J\'aime</span>';
            }
        }
    };

    window.setUserRating = async function(stars) {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return;

        const currentDetail = detail.title || detail.name;
        const state = window.getDetailStateFromFirebase(currentDetail);
        state.rating = stars;

        // Sauvegarder sur Firebase
        await window.saveDetailStateToFirebase(currentDetail, state);

        // Charger les profils et mettre √† jour la note
        if(!window.profiles) {
            window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
            window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
        }
        
        // Mettre √† jour la note dans la biblioth√®que si le film y est
        const type = detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series';
        if(window.profiles && window.profiles.length > 0) {
            const profile = window.profiles[window.currentProfileIndex || 0];
            if(profile) {
                const arr = type === 'animes' ? profile.animes : type === 'films' ? profile.films : profile.series;
                const existingItem = arr.find(a => a.title === currentDetail);
                if(existingItem) {
                    existingItem.rating = stars;
                    if(window.saveProfiles) {
                        await window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                }
            }
        }

        window.displayRating(stars);
    };

    window.openReviewModal = function() {
        const modal = document.getElementById("reviewModal");
        if(modal) modal.classList.add("active");
    };

    window.closeReviewModal = function() {
        const modal = document.getElementById("reviewModal");
        if(modal) modal.classList.remove("active");
    };

    window.openReview = window.openReviewModal;

    window.saveReview = async function() {
        const detail = JSON.parse(localStorage.getItem("tmdbDetail"));
        if(!detail) return alert("Erreur: Donn√©es manquantes");

        const reviewText = document.getElementById("reviewText").value;
        const currentDetail = detail.title || detail.name;
        const state = window.getDetailStateFromFirebase(currentDetail);
        state.review = reviewText;

        // Sauvegarder sur Firebase
        await window.saveDetailStateToFirebase(currentDetail, state);

        // Charger les profils si n√©cessaire
        if(!window.profiles) {
            window.profiles = JSON.parse(localStorage.getItem("profiles")) || [];
            window.currentProfileIndex = JSON.parse(localStorage.getItem("currentProfileIndex")) || 0;
        }

        // Mettre √† jour la comment dans la biblioth√®que
        const type = detail.type === 'movie' ? 'films' : detail.type === 'anime' ? 'animes' : 'series';
        if(window.profiles && window.profiles.length > 0) {
            const profile = window.profiles[window.currentProfileIndex || 0];
            if(profile) {
                const arr = type === 'animes' ? profile.animes : type === 'films' ? profile.films : profile.series;
                const existingItem = arr.find(a => a.title === currentDetail);
                if(existingItem) {
                    existingItem.comment = reviewText;
                    if(window.saveProfiles) {
                        await window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                } else {
                    // Cr√©er un nouvel item avec le review
                    const newItem = {
                        title: currentDetail,
                        image: detail.poster || 'https://via.placeholder.com/400x600',
                        rating: state.rating || 0,
                        date: new Date().toISOString().split("T")[0],
                        comment: reviewText
                    };
                    arr.push(newItem);
                    if(window.saveProfiles) {
                        await window.saveProfiles();
                    } else {
                        localStorage.setItem("profiles", JSON.stringify(window.profiles));
                    }
                }
            }
        }

        alert("Avis sauvegard√© !");
        document.getElementById("reviewText").value = "";
        window.closeReviewModal();
    };

    window.showActivity = function() {
        alert("Fonctionnalit√© en cours de d√©veloppement");
    };

    window.addToLists = function() {
        alert("Fonctionnalit√© en cours de d√©veloppement");
    };

    // Charger la page au chargement
    setTimeout(() => {
        window.loadDetailPage();
    }, 300);
</script>

</body>
</html>
