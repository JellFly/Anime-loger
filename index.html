<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Tracker - Accueil</title>
<link rel="stylesheet" href="style.css">
</head>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDWbsbfnF5e-E3rCMguVFF69PpAM-ZlAZ4",
  authDomain: "anime-lo.firebaseapp.com",
  projectId: "anime-lo",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- CREATION DE COMPTE ---
async function register(email, password) {
  await createUserWithEmailAndPassword(auth, email, password);

  // cr√©er doc utilisateur
  await setDoc(doc(db, "users", auth.currentUser.uid), {
    favoris: [],
    liste: [],
    parametres: {}
  });

  alert("Compte cr√©√© !");
}

// --- CONNEXION ---
async function login(email, password) {
  await signInWithEmailAndPassword(auth, email, password);
  alert("Connect√© !");
}

// --- DECONNEXION ---
async function logout() {
  await signOut(auth);
  alert("D√©connect√©");
}

// --- AJOUT FAVORI ---
async function addFavori(anime) {
  const ref = doc(db, "users", auth.currentUser.uid);
  await updateDoc(ref, {
    favoris: arrayUnion(anime)
  });
}

// --- RECUPERATION DES DONNEES ---
async function loadUserData() {
  const ref = doc(db, "users", auth.currentUser.uid);
  const snap = await getDoc(ref);
  console.log("Donn√©es :", snap.data());
}
</script>

<body>

<header>
    <h1>üéå Anime Tracker</h1>
    <nav>
        <a href="index.html">Accueil</a> |
        <a href="profiles.html">Profils</a> |
        <a href="add.html">Ajouter anim√©</a> |
        <a href="list.html">Liste anim√©s</a> |
        <a href="about.html">√Ä propos</a>
    </nav>
</header>

<main>
<section>
<h2>üëã Bienvenue !</h2>
<p class="small">Suivi d‚Äôanim√©s pour le profil actuel</p>

<div class="stats">
    <div class="stat-box"><strong id="statTotal">0</strong><div class="small">Anim√©s vus</div></div>
    <div class="stat-box"><strong id="statAverage">0</strong><div class="small">Note moyenne ‚≠ê</div></div>
    <div class="stat-box"><strong id="statBest">-</strong><div class="small">Meilleur anim√©</div></div>
    <div class="stat-box"><strong id="statWatch">0</strong><div class="small">Dans la watchlist</div></div>
</div>
</section>
</main>

<script src="site.js"></script>
<input id="email" placeholder="email">
<input id="pass" type="password" placeholder="mot de passe">
<button onclick="register(email.value, pass.value)">Cr√©er un compte</button>
<button onclick="login(email.value, pass.value)">Connexion</button>
<button onclick="logout()">D√©connexion</button>

<input id="anime" placeholder="Nom anime">
<button onclick="addFavori(anime.value)">Ajouter aux favoris</button>

<button onclick="loadUserData()">Voir mes donn√©es</button>

</body>
</html>
